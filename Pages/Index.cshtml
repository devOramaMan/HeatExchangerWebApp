@page
@model IndexModel
@{
    ViewData["Title"] = "Heat Exchanger Monitor";
}

<div class="ventilation-container">
    <div class="house-diagram">
        <div class="house">
            <div class="roof"></div>
            <div class="house-body">
                <div class="ventilation-unit">
                    <div class="chambers-container">
                        <div class="chamber" id="chamber1">
                            <div class="chamber-label">Supply Air</div>
                            <div class="temperature-display">
                                <span class="temp-value" id="temp2">18.0</span>
                                <span class="temp-unit">°C</span>
                            </div>
                        </div>
                        <div class="chamber" id="chamber2">
                            <div class="chamber-label">Exhaust Air Out</div>
                            <div class="temperature-display">
                                <span class="temp-value" id="temp4">8.0</span>
                                <span class="temp-unit">°C</span>
                            </div>
                        </div>
                        <div class="chamber" id="chamber3">
                            <div class="chamber-label">Extract Air</div>
                            <div class="temperature-display">
                                <span class="temp-value" id="temp3">20.0</span>
                                <span class="temp-unit">°C</span>
                            </div>
                        </div>
                        <div class="chamber" id="chamber4">
                            <div class="chamber-label">Outdoor Air In</div>
                            <div class="temperature-display">
                                <span class="temp-value" id="temp1">5.0</span>
                                <span class="temp-unit">°C</span>
                            </div>
                        </div>
                    </div>
                    <!-- Central heat exchanger core -->
                    <div class="heat-exchanger-core">
                        <div class="core-inner">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Efficiency calculation -->
        <div class="efficiency-display">
            <h3>Efficiency</h3>
            <div class="efficiency-value" id="efficiencyValue">78.6%</div>
            <div class="efficiency-formula">η = (T2-T1)/(T3-T1) × 100%</div>
        </div>
    </div>
    
    <!-- Core Controls -->
    <div class="core-controls">
        <h4>Heat Exchanger Core Controls</h4>
        <div class="control-group">
            <label class="control-label">
                <input type="checkbox" id="rotationToggle" />
                Enable Rotation
            </label>
            <div class="rpm-control">
                <label for="rpmSlider">RPM: <span id="rpmValue">60</span></label>
                <input type="range" id="rpmSlider" min="10" max="300" value="60" />
            </div>
        </div>
    </div>

    <!-- Data Source Toggle -->
    <div class="core-controls">
        <h4>Data Source</h4>
        <div class="control-group">
            <form id="dataSourceForm">
                <label>
                    <input type="radio" name="dataSource" value="Simulator" asp-for="@Model.DataSource" /> Simulator Only
                </label>
                <br />
                <label>
                    <input type="radio" name="dataSource" value="PostGres" asp-for="@Model.DataSource" /> PostGres Database
                </label>
                <br />
                <label>
                    <input type="radio" name="dataSource" value="AzureWebPubSub" checked asp-for="@Model.DataSource" /> Azure Web Pub Sub
                </label>
            </form>
            <div id="dataSourceStatus" class="data-source-status">Mode: Azure Web PubSub - Initializing...</div>
        </div>
    </div>

    <!-- Efficiency chart -->
    <div class="chart-container">
        <canvas id="efficiencyChart" width="800" height="300"></canvas>
    </div>

    <!-- Database Status -->
    <div class="database-status">
        <h4>Database Connection Status</h4>
        <div id="dbStatus" class="status-indicator">Checking...</div>
        <button onclick="testDatabaseConnection()" class="btn btn-primary">Test Connection</button>
        <button onclick="insertTestData()" class="btn btn-success">Insert Test Data</button>
        <button onclick="getLatestReadings()" class="btn btn-info">Get Latest Readings</button>
    </div>

    <!-- Terminology -->
    <div class="terminology">
        <h4>Heat Exchanger Terminology</h4>
        <!-- bullets for T1, T2, T3, T4 -->
        <ul>
            <li><strong>T1:</strong> Outdoor Air In   - Fresh air drawn into the ventilation unit from outside</li>
            <li><strong>T2:</strong> Supply Air       - Fresh air delivered into indoor spaces from the ventilation unit</li>
            <li><strong>T3:</strong> Extract Air      - Air from indoor spaces that is being expelled to the ventilation unit</li>
            <li><strong>T4:</strong> Exhaust Air Out  - Air expelled from the ventilation unit to the outside</li>
        </ul>
        </ul>
    </div>
</div>

@section Scripts {
    <script src="~/dist/js/chart.umd.js"></script>
    <script src="~/js/index.js"></script>
}
